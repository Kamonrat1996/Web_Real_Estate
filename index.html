<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MK Real Estate</title>
    <script src="static/JavaScript/jquery-3.5.1.min.js"></script>
    <script src="static/anime-master/lib/anime.min.js"></script>
    <script src="ajax/bootstrap.bundle.min.js"></script>
    <link rel="icon" type="image/x-icon" href="favicon.ico">

    <style>
        body {
            margin: 0px;
            padding: 0px;
        }
        
        ul {
            margin: 0px;
            padding: 0px;
            list-style: none;
            overflow: auto;
        }
        
        li {
            display: inline-block;
            padding: 5px;
            padding-top: 15px;
            padding-bottom: 15px;
            overflow: auto;
            overflow: hidden;
        }
        
        li a {
            height: 100%;
            text-decoration: none;
            color: rgb(63, 5, 117);
            padding-top: 12px;
            padding-bottom: 12px;
            padding-left: 10px;
            padding-right: 10px;
            font-size: 20px;
            /* font-weight: bold; */
        }
        
        li:hover a {
            color: rgb(14, 132, 243);
            text-shadow: 2px 2px 5px rgb(166, 186, 243);
        }
        
        li:hover {
            background-color: rgb(216, 116, 116);
        }
        
        .menu {
            background-color: rgba(131, 124, 124, 0.3);
            overflow: auto;
            padding-left: 15px;
            padding-right: 15px;
        }
        
        .align_right_menu {
            float: right;
        }
        /* dropdown start*/
        
        .dropdown_content {
            display: none;
            margin-top: 15px;
            position: absolute;
            background-color: rgba(131, 124, 124, 0.3);
            box-shadow: 2px 2px 5px black;
            z-index: 100;
        }
        
        .dropdown_content ul li {
            display: block;
            color: rgb(6, 63, 116);
        }
        
        .dropdown_content ul li a {
            color: rgb(6, 63, 116);
            width: auto;
            right: 0%;
            margin-left: 0px;
            margin-right: 0px;
        }
        
        .dropdown_menu {
            z-index: 100;
        }
        
        .dropdown_menu:hover .dropdown_content {
            display: block;
        }
        
        .dropdown_content li:hover a {
            color: rgb(14, 132, 243);
        }
        /* dropdown end*/
        /* search_start*/
        
        .main {
            width: 80%;
            /* height: 150px; */
            margin-left: auto;
            margin-right: auto;
            background-color: rgba(231, 119, 175, 0.788);
            opacity: 0;
            text-align: center;
            padding: 10px;
        }
        
        .container01 {
            width: 100%;
            height: 1000px;
            background-image: url('static/img/4.jpg');
        }
        
        .container02 {
            width: 100%;
            height: auto;
            min-height: 800px;
            background-color: rgb(133, 228, 228);
            display: flex;
            flex-direction: row;
            flex-wrap: wrap;
        }
        
        .container03 {
            width: 100%;
            height: auto;
            min-height: 800px;
            background-color: rgb(198, 236, 191);
            display: flex;
            flex-direction: row;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
        }
        
        .main2 {
            margin-top: 30px;
            min-width: 300px;
            max-width: 320px;
            height: 700px;
            margin-left: auto;
            margin-right: auto;
            background-color: rgba(235, 39, 137, 0.788);
            opacity: 0;
        }
        
        .main2 .image {
            width: 100%;
            padding: 0px;
            margin: 0px;
        }
        
        .main2 .image img {
            width: 100%;
            padding: 0px;
            margin: 0px;
        }
        
        .main2 .information {
            padding: 25px;
            line-height: 1rem;
        }
        
        .search_box {
            padding: 20px;
            margin-top: 30px;
            border: rgb(66, 64, 64) solid;
            border-radius: 25px;
            background-color: rgba(66, 64, 64, 0.5);
        }
        
        .search_box form input[type=submit] {
            height: 40px;
            border-radius: 0px 10px 10px 0px;
        }
        
        .search_box form select {
            height: 40px;
        }
        
        .search_box form input[type=text] {
            height: 40px;
            border: 0px;
            padding-top: 0px;
            padding-bottom: 0px;
            border-radius: 10px 0px 0px 10px;
        }
        
        .main h1 {
            color: white;
            text-shadow: 2px 2px rgb(31, 8, 8);
        }
        
        .main b {
            color: white;
        }
    </style>


    <script>
        // ฟังก์ชันสร้าง HTML ของแต่ละ property
        // ใช้ Template Literal (` ... `) เพื่อสร้าง HTML ในรูปแบบ string
        // แทรกค่าตัวแปรด้วย ${ ... }
        // คืนค่า template กลับไปเพื่อ append ลงบนหน้าเว็บ
        function ItemTemplate(id, real_estate_name, LOCATION, property_type, SALE_TERMS, SALE_PRICE, RENT_PRICE, BEDROOMS, UNIT_SIZE, LAND_AREA, image_01, btn_id, prop_id) {
            let template = `
    <div class="main2" id="property-${id}">
        <div class="image">
            <img src="${image_01}" alt="${real_estate_name}">
        </div>
        <div class="information">
            <p>${real_estate_name}</p>
            <p>สถานที่: ${LOCATION}</p>
            <p>ชนิดของหลักทรัพย์: ${property_type}</p>
            <p>สิทธิ์การขาย: ${SALE_TERMS}</p>
            <p>ราคาขาย: ${SALE_PRICE} บาท</p>
            <p>ราคาเช่า: ${RENT_PRICE} บาท</p>
            <p>จำนวนห้องนอน: ${BEDROOMS} ห้อง</p>
            <p>ขนาดยูนิต: ${UNIT_SIZE} ตารางเมตร</p>
            <p>ขนาดที่ดิน: ${LAND_AREA} ตารางวา</p>
            <p><button id="${btn_id}" class="select_prop_btn btn btn-primary" propertyID="${prop_id}">แสดงรายละเอียด</button></p>
        </div>
    </div>
    `;
            return template;
        }

        function onOpenPropertyDetail(id) {
            let PropertyID = id;
            $.getJSON("https://expert-programming-tutor.com/Downloads/w701/property_detail.php?id=" + PropertyID, function(data) {
                var rows = [];

                $.each(data, function(key, val) {
                    rows.push(
                        "<tr>" +
                        "<td style='border:1px solid black; padding:5px;'>" + key + "</td>" +
                        "<td style='border:1px solid black; padding:5px;'>" + val + "</td>" +
                        "</tr>"
                    );
                });

                var table =
                    "<table style='border:1px solid black; border-collapse:collapse; margin:auto;'>" +
                    "<thead><tr>" +
                    "<th style='border:1px solid black; padding:5px;'>Field</th>" +
                    "<th style='border:1px solid black; padding:5px;'>Value</th>" +
                    "</tr></thead>" +
                    "<tbody>" + rows.join("") + "</tbody>" +
                    "</table>";

                $(".container03").append(table);
                //เปลี่ยนรูปภาพใน <img> ตามค่าที่ได้จาก JSON โดยใช้ jQuery .attr()
                // $("#image_01").attr("src", data.image_01);
                // $("#image_02").attr("src", data.image_02);
                // $("#image_03").attr("src", data.image_03);
                // $("#image_04").attr("src", data.image_04);
                // $("#image_05").attr("src", data.image_05);
            });
        }

        function onSearch() {
            let keyword = $("#keyword").val(); // เอาค่าจาก input
            console.log("ค้นหา: " + keyword);

            $(".container02").html(""); // ล้างผลลัพธ์เก่า

            $.getJSON("https://expert-programming-tutor.com/Downloads/w701/property_search.php?locate=" + keyword, function(data) {
                if (Array.isArray(data)) {
                    data.forEach(item => {
                        let html = ItemTemplate(
                            item.id,
                            item.real_estate_name,
                            item.LOCATION,
                            item.property_type,
                            item.SALE_TERMS,
                            item.SALE_PRICE,
                            item.RENT_PRICE,
                            item.BEDROOMS,
                            item.UNIT_SIZE,
                            item.LAND_AREA,
                            item.image_01,
                            "btn-" + item.id,
                            item.id
                        );
                        $(".container02").append(html);
                    });
                } else if (typeof data === "object" && data !== null) {
                    let temp = ItemTemplate(
                        data.id,
                        data.real_estate_name,
                        data.LOCATION,
                        data.property_type,
                        data.SALE_TERMS,
                        data.SALE_PRICE,
                        data.RENT_PRICE,
                        data.BEDROOMS,
                        data.UNIT_SIZE,
                        data.LAND_AREA,
                        data.image_01,
                        data.btn_id
                    );
                    $(".container02").append(temp);
                }

                $(".select_prop_btn").each(function() {

                    $(this).click(function() {
                        let prop_id = $(this).attr("propertyID");
                        onOpenPropertyDetail(prop_id);
                    })
                })
            });

            return false;
        }
    </script>
</head>

<body>
    <div class="menu">
        <ul>
            <li><a href="#">Home</a></li>
            <li class="dropdown_menu">
                <a href="#">Buy</a>
                <div class="dropdown_content">
                    <ul>
                        <li><a href="#">บ้าน</a></li>
                        <li><a href="#">คอนโด</a></li>
                        <li><a href="#">เชิงพาณิชย์</a></li>
                    </ul>
                </div>
            </li>
            <li><a href="#">Sell</a></li>
            <li><a href="#">Search</a></li>
            <li><a href="#">About us</a></li>
            <li class="align_right_menu"><a href="#">Login</a></li>

        </ul>
    </div>
    <!-- End of menu -->

    <!--start search-->
    <div class="container01">
        <div class="main">
            <h1>ซื้อขายอสังหาในประเทศไทย</h1>
            <b>เราช่่วยให้คุณหาบ้านและที่ดินที่ถูกใจคุณ</b>
            <div class="search_box">
                <form action="" onsubmit="return onSearch()">
                    <label for="keyword">คำค้นหา</label>
                    <input type="text" name="keyword" id="keyword" placeholder="กรอกคำค้นหา...">

                    <label for="property_type">ประเภททรัพย์สิน</label>
                    <select name="property_type" id="property_type">
                        <option value="">บ้าน</option>
                        <option value="">ที่ดิน</option>
                        <option value="">เชิงพาณิชย์</option>
                    </select>

                    <input type="submit" value="search">
                </form>
            </div>
        </div>
    </div>
    <div class="container02">

    </div>

    <div class="container03">

    </div>

    <script>
        // เริ่มต้น animation ให้ .main ตั้งแต่โหลดหน้าเสร็จ ใช้ library Anime.js เพื่อทำอนิเมชัน
        anime({
            targets: '.main',
            backgroundColor: 'hsla(0, 0%, 50%, 0.5)',
            opacity: [0, 1],
            translateY: 0,
            duration: 800,
            rotate: '2turn',
            delay: 800,


        });
        // รอให้ DOM โหลดเสร็จทั้งหมดก่อนทำงาน
        $(document).ready(function() {
            // Part 3 – ปรับขนาด .container01 ให้สูงเท่ากับหน้าจอ - ความสูงเมนู
            var menu_height = $(".menu").height();
            var windows_height = $(window).height();
            var image_height = windows_height - menu_height;
            $(".container01").height(image_height);

            // เมื่อ resize window ก็ทำใหม่อีกครั้ง
            $(window).resize(function() {
                var menu_height = $(".menu").height();
                var windows_height = $(window).height();
                var image_height = windows_height - menu_height;
                $(".container01").height(image_height);
            });

            // Part 4 – ฟังก์ชัน Animation สำหรับ .main2
            var animationForMain2 = function() {
                let y_translate = 50;
                // เช็คว่า animation ทำไปแล้วหรือยัง
                if ($(".main2").attr("animation_finish") == 1) {
                    return;
                }
                // ตั้งค่า attribute ว่า animation กำลังทำ
                // กำหนดให้ element มี attribute animation_finish="1" เพื่อใช้เช็คในครั้งถัดไปว่า animation ไม่ซ้ำ
                $(".main2").attr("animation_finish", 1);
                let height = parseInt($('.container02').css('height'), 10);
                let element_margin = parseInt($('.main2').css('margin-top'), 10);
                $('.container02').height((height + y_translate + element_margin + 100) + "px");
                // กำหนด Anime timeline
                var timeline = anime.timeline({
                    easing: 'easeOutElastic(5, .5)',
                    duration: 800,
                }).add({
                    targets: '.main2',
                    translateY: y_translate,
                    opacity: [0, 1],
                    rotate: '1turn',
                    backgroundColor: '#fff5ba',
                });
                // เรียก callback หลัง animation เสร็จ
                timeline.finished.then(function() {
                    $(".main2").attr("animation_finish", 1);
                });
            };

            $(window).scroll(function() {
                let target = $('.main2');

                if (target.length === 0) {
                    return;
                }

                var hT = target.offset().top,
                    hH = target.outerHeight(),
                    wH = $(window).height(),
                    wS = $(this).scrollTop();

                if (wS > (hT + hH - wH)) {
                    console.log('H1 on the view!');
                    animationForMain2();
                }
            });
        });
    </script>
    <script src="ajax/bootstrap.bundle.min.js"></script>
</body>

</html>